name: ungoogled-chromium
version: 89.0.4389.114-2
base: core20

summary: Google Chromium, sans integration with Google
description: |
  This is Google Chromium, sans dependency on Google web services.

  Ungoogled Chromium retains the default Chromium experience as closely
  as possible. Unlike other Chromium forks that have their own visions
  of a web browser, Ungoogled Chromium is essentially a drop-in replacement
  for Chromium. It also features tweaks to enhance privacy, control,
  and transparency.

confinement: strict
grade: stable

architectures:
  - build-on: amd64

parts:
  base:
    plugin: dump
    source: ./sources/ungoogled-chromium_89.0.4389.114-1.focal2_amd64.deb
    source-type: deb
    override-build: |
      snapcraftctl build
      sed -i 's|Icon=chromium|Icon=/usr/share/icons/hicolor/256x256/apps/chromium\.png|' ${SNAPCRAFT_PART_INSTALL}/usr/share/applications/chromium.desktop
    stage-packages:
      - lsb-release
      - libatomic1
      - libx11-xcb-dev
      - libxcomposite-dev
      - libxdamage-dev
      - libxi-dev
      - libxrandr-dev
      - libxtst-dev
      - libasound-dev
      - libatk-bridge2.0-0
      - libcairo2
      - libgtk-3-dev
      - libgdk-pixbuf2.0-dev
      - libnspr4-dev
      - libnss3-dev
      - libpci-dev
      - libminizip-dev
      - libjsoncpp1
      - libopus-dev
      - libre2-5
      - libsnappy1v5
      - libvpx6
      - libwebp6
      - libwebpdemux2
      - ffmpeg
      - libglu1-mesa
      - freeglut3

  common:
    plugin: dump
    source: ./sources/ungoogled-chromium-common_89.0.4389.114-1.focal2_amd64.deb
    source-type: deb

  l10n:
    plugin: dump
    source: ./sources/ungoogled-chromium-l10n_89.0.4389.114-1.focal2_all.deb
    source-type: deb

  driver:
    plugin: dump
    source: ./sources/ungoogled-chromium-driver_89.0.4389.114-1.focal2_amd64.deb
    source-type: deb

  shell:
    plugin: dump
    source: ./sources/ungoogled-chromium-shell_89.0.4389.114-1.focal2_amd64.deb
    source-type: deb

  desktop-gnome-platform:
    source: https://github.com/ubuntu/snapcraft-desktop-helpers.git
    source-depth: 1
    source-subdir: gtk
    plugin: make
    build-packages:
      - build-essential
      - libgtk-3-dev
    override-build: |
      snapcraftctl build
      mkdir -pv $SNAPCRAFT_PART_INSTALL/gnome-platform

slots:
  dbus-daemon:
    interface: dbus
    bus: session
    name: com.github.joffreybvn.ungoogled-chromium-snapcraft

apps:
  ungoogled-chromium:
    extensions: [gnome-3-38]
    command: bin/desktop-launch $SNAP/usr/bin/chromium --no-sandbox
    desktop: usr/share/applications/chromium.desktop
    environment:
      DISABLE_WAYLAND: 1
      CHROME_DESKTOP: usr/share/applications/chromium.desktop
      CHROME_CONFIG_HOME: $SNAP_USER_COMMON
    plugs:
      - browser-support
      - audio-playback
      - audio-record
      - bluez # for Web Bluetooth (https://launchpad.net/bugs/1887201)
      - camera
      - cups-control
      - home
      - joystick
      - mount-observe
      - network
      - network-manager
      - password-manager-service
      - pulseaudio # remove once snapd 2.41 is available everywhere
      - raw-usb # for WebUSB (https://launchpad.net/bugs/1780678)
      - removable-media
      - screen-inhibit-control
      - system-packages-doc
      - u2f-devices
      - upower-observe
      # Interfaces:
      - opengl
      - desktop
      - desktop-legacy
      - wayland
      - x11
      - unity7
    slots:
      - dbus-daemon
    common-id: com.github.joffreybvn.ungoogled-chromium-snapcraft
